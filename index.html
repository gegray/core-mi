<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="mobile-web-app-capable" content="yes">
        <title>Core-MI Report</title>

        <!-- Included libraries -->
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.css" />
		<script src="https://code.jquery.com/jquery.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
		<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>

		<!-- Fonts -->
		<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700,900,100italic,300italic,400italic,500italic,700italic,900italic' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Raleway:400,900,500,600,700,800,300,200,100' rel='stylesheet' type='text/css'>

		<!-- Custom CSS -->
		<link href="css/custom.css" type="text/css" rel="stylesheet">	
    </head>

    <body>
    	<div class="container">

    		<!-- CORE-MI REPORT -->
    		<div class="row headerBackground">
    			<div class="col-sm-12">
		        	<p class="t1">Core-MI Report</p>
		        </div>
		    </div> <!-- row -->

		    <!-- Session #, Therapist, Client -->
		    <div class="row">
		        <div class="sessionInfo">
	        		<div class="col-sm-4">
				        <p class="t4">Session Number</p>
				        <p class="p1" id="d3SessionNumber">
				        	<!-- D3 Reflection to Question Ratio: number GOES HERE -->
				        </p>
				        <p class="p1" id="d3Date">
				        	<!-- D3 Date (and time?) GOES HERE -->
				        </p>
				    </div>
				    <div class="col-sm-4">
				        <p class="t4">Therapist</p>
				        <p class="p1" id="d3TherapistName">
				        	<!-- D3 Therapist Name GOES HERE -->
				        </p>
				    </div>
				    <div class="col-sm-4">
				        <p class="t4">Client</p>
				        <p class="p1" id="d3ClientInfo">
				        	<!-- D3 Client Info GOES HERE -->
				        </p>
				    </div>
			    </div> <!-- sessionInfo -->
			</div> <!-- row -->
			<hr>

			<!-- Overall, Global, Notes -->
			<div class="row">
				<div class="coreInfo">
					<!-- Left Column -->
					<div class="col-sm-4">
				        <p class="t2">Overall MI Fidelity
				        	<!-- Trigger the modal with a button -->
				        	<span type="button" data-toggle="modal" data-target="#overallMiFidelityModal" class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
				        	<!-- Modal -->
				        	<div id="overallMiFidelityModal" class="modal fade" role="dialog">
				        		<div class="modal-dialog">
				        			<!-- Modal content-->
				        			<div class="modal-content">
				        				<div class="modal-header">
				        					<button type="button" class="close" data-dismiss="modal">&times;</button>
				        					<h4 class="modal-title">Modal Header</h4>
				        				</div>
				        				<div class="modal-body">
				        					<p>Some text in the modal.</p>
				        				</div>
				        				<div class="modal-footer">
				        					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				        				</div>
				        			</div>
				        		</div>
				        	</div>
				        </p>
				        <p class="totalScore1"><span id="d3OverallMIFidelity" class="green"></span><span class="totalScore2">/12</span></p>
				        <p class="t3">MI Adherence</p>

				        <div id = "pie">
				        	<!-- D3 MI Adherence pie chart GOES HERE -->
				        </div>

				        <p class="t3">MI Alerts</p>
				        <p class="p1 red w900"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> 2 Advise</p>
				        <p class="p1 red w900"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> 1 Confront</p>
				        <p class="p1 red w900"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> 1 Direction</p>
				    </div>
				    <!-- Middle Column -->
				    <div class="col-sm-4">
				    	<p class="t2">Global Ratings
				    		<!-- Trigger the modal with a button -->
				        	<span type="button" data-toggle="modal" data-target="#globalRatingsModal" class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
				        	<!-- Modal -->
				        	<div id="globalRatingsModal" class="modal fade" role="dialog">
				        		<div class="modal-dialog">
				        			<!-- Modal content-->
				        			<div class="modal-content">
				        				<div class="modal-header">
				        					<button type="button" class="close" data-dismiss="modal">&times;</button>
				        					<h4 class="modal-title">Modal Header</h4>
				        				</div>
				        				<div class="modal-body">
				        					<p>Some text in the modal.</p>
				        				</div>
				        				<div class="modal-footer">
				        					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				        				</div>
				        			</div>
				        		</div>
				        	</div>
				    	</p>

				    	<div id="d3GlobalRatings">
				    		<!-- D3 Global Ratings GOES HERE -->
				    	</div>
				    	<!-- Global Ratings Labels (below) TO GO HERE -->

				    	<div id="globalRatingsLabels">
				    		<span></span>
							<span>
								<p class="p1 centerText">MI Spirit</p>
							</span>
							<span></span>
							<span>
								<p class="p1 centerText">Empathy</p>
							</span>
							<span></span>
				    	</div>
				    </div>
				    <!-- Right Column -->
				    <div class="col-sm-4">
				    	<p class="t2">Notes
				    		<!-- Trigger the modal with a button -->
				        	<span type="button" data-toggle="modal" data-target="#notesModal" class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
				        	<!-- Modal -->
				        	<div id="notesModal" class="modal fade" role="dialog">
				        		<div class="modal-dialog">
				        			<!-- Modal content-->
				        			<div class="modal-content">
				        				<div class="modal-header">
				        					<button type="button" class="close" data-dismiss="modal">&times;</button>
				        					<h4 class="modal-title">Modal Header</h4>
				        				</div>
				        				<div class="modal-body">
				        					<p>Some text in the modal.</p>
				        				</div>
				        				<div class="modal-footer">
				        					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				        				</div>
				        			</div>
				        		</div>
				        	</div>
				    	</p>
				    	<div id="d3NotesGeneral">
				    		<!-- D3 Notes: general GOES HERE-->
				    	</div>
				    	<p class="t3">Session Strengths</p>
				    	<div id="d3NotesStrengths">
				    		<!-- D3 Notes: session strengths GOES HERE -->
				    	</div>
				    	<p class="t3">Areas for Improvement</p>
				    	<div id="d3NotesImprovements">
				    		<!-- D3 Notes: areas for improvement GOES HERE -->
				    	</div>
				    </div>
				</div> <!-- coreInfo -->
			</div> <!-- row -->
			
			<!-- Behavior Counts -->
			<div class="row">
				<div class="behaviorCounts">
					<!-- Left Column - Blank -->
					<div class="col-sm-4">
					</div>
					<!-- Middle & Right Columns -->
					<div class="col-sm-8">
						<hr>
						<p class="t2">Behavior Counts
							<!-- Trigger the modal with a button -->
				        	<span type="button" data-toggle="modal" data-target="#overallMiFidelityModal" class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
				        	<!-- Modal -->
				        	<div id="overallMiFidelityModal" class="modal fade" role="dialog">
				        		<div class="modal-dialog">
				        			<!-- Modal content-->
				        			<div class="modal-content">
				        				<div class="modal-header">
				        					<button type="button" class="close" data-dismiss="modal">&times;</button>
				        					<h4 class="modal-title">Modal Header</h4>
				        				</div>
				        				<div class="modal-body">
				        					<p>Some text in the modal.</p>
				        				</div>
				        				<div class="modal-footer">
				        					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				        				</div>
				        			</div>
				        		</div>
				        	</div>
						</p>
						<p class="p1">Reflection to Question Ratio: 
							<span class="w900" id="d3RToQNum">
								<!-- D3 Reflection to Question Ratio: number GOES HERE -->
							</span> (Reflection : Question)
						</p>
						<!-- D3 Reflection to Question: bar graph -->
				        <div id="d3RToQBar">
					        <!-- D3 Reflection to Question Ratio: bar graph GOES HERE -->
					    </div>
					    <div id="d3RToQBarAxis">
					    	<div class="d3RToQBarAxisColumn">
					    		<p class="p2 gray">|<br>&ge; 3.0 |</p>
					    	</div>
					    	<div class="d3RToQBarAxisColumn axesShiftLeft">
					    		<p class="p2 gray">|<br>p: 2.0 |</p>
					    	</div>
					    	<div class="d3RToQBarAxisColumn axesShiftLeft">
					    		<p class="p2 gray">|<br>c: 1.0 |</p>
					    	</div>
					    </div>

						<p class="p1">Percent Open Questions: 
							<span class="w900" id="d3POQNum">
								<!-- D3 Reflection to Question Ratio: number GOES HERE -->
							</span>% (Open : Closed)
						</p>
						<!-- D3 Percent Open Questions: bar graph -->
				        <div id="d3PctOpenQuestionsBar">
					        <!-- D3 Percent Open Questions: bar graph GOES HERE -->
					    </div>
						<div id="d3PctOpenQuestionsAxis">
					    	<div class="d3PctOpenQuestionsAxisColumnEmpty">
					    		<p class="p2 gray">|<br>100 |</p>
					    	</div>
					    	<div class="d3PctOpenQuestionsAxisColumnProficiency axesShiftLeft">
					    		<p class="p2 gray">|<br>p: 70 |</p>
					    	</div>
					    	<div class="d3PctOpenQuestionsAxisColumnCompetency axesShiftLeft">
					    		<p class="p2 gray">|<br>c: 50 |</p>
					    	</div>
					    </div>

						<p class="p1">Percent Complex Reflections: 
							<span class="w900" id="d3PCRNum">
								<!-- D3 Reflection to Question Ratio: number GOES HERE -->
							</span>% (Complex : Simple)
						</p>
						<!-- D3 Reflection to Question: bar graph -->
				        <div id="d3PctComplexReflectionsBar">
					        <!-- D3 Reflection to Question Ratio: bar graph GOES HERE -->
					    </div>
						<div id="d3PctComplexReflectionsAxis">
					    	<div class="d3PctComplexReflectionsAxisColumnEmpty">
					    		<p class="p2 gray">|<br>100 |</p>
					    	</div>
					    	<div class="d3PctComplexReflectionsAxisColumnProficiency axesShiftLeft">
					    		<p class="p2 gray">|<br>p: 50 |</p>
					    	</div>
					    	<div class="d3PctComplexReflectionsAxisColumnCompetency axesShiftLeft">
					    		<p class="p2 gray">|<br>c: 40 |</p>
					    	</div>
					    </div>

					</div>
				</div> <!-- behaviorCounts -->
			</div> <!-- row -->
			<hr>

			<!-- Session View - Title -->
			<div class="row">
				<div class="col-sm-12">
					<p class="t2">Session View
						<!-- Trigger the modal with a button -->
			        	<span type="button" data-toggle="modal" data-target="#sessionViewModal" class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
			        	<!-- Modal -->
			        	<div id="sessionViewModal" class="modal fade" role="dialog">
			        		<div class="modal-dialog">
			        			<!-- Modal content-->
			        			<div class="modal-content">
			        				<div class="modal-header">
			        					<button type="button" class="close" data-dismiss="modal">&times;</button>
			        					<h4 class="modal-title">Modal Header</h4>
			        				</div>
			        				<div class="modal-body">
			        					<p>Some text in the modal.</p>
			        				</div>
			        				<div class="modal-footer">
			        					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			        				</div>
			        			</div>
			        		</div>
			        	</div>
					</p>
				</div>
			</div>

			<!-- Session View - Legend -->
			<div class="row">
				<div class="sessionView">
					<div class="col-sm-2">
						<div class="therapistBox">
						</div>
						<p class="p1">Therapist</p>
					</div>
					<div class="col-sm-2">
						<div class="clientBox">
						</div>
						<p class="p1">Client</p>
					</div>
					<div class="col-sm-8">
						<p class="p1">Percent Talk Time: 
							<span class="w900" id="d3PctTalkTimeNum">
								<!-- D3 Percent Talk Time: number GOES HERE -->
							</span>% (Therapist : Client)
						</p>

						<!-- D3 Percent Talk Time: bar graph -->
				        <div id="d3PctTalkTimeBar">
					        <!-- D3 Percent Talk Time: bar graph GOES HERE -->
					    </div>
					</div>
				</div> <!-- sessionView -->
			</div> <!-- row -->

			<!-- Session View - Overview Title -->
			<div class="row">
				<div class="col-sm-12">
					<p class="t3">Overview</p>
				</div>
			</div>

			<!-- Session View - Overview Bar -->
			<div class="row">
				<div class="col-sm-12">
					<div id="d3SessionOverview">
						<!-- D3 Session View, Overview: timeline GOES HERE -->
					</div>
				</div>
			</div> <!-- row -->

			<!-- Session View - Detail View Title -->
			<div class="row">
				<div class="col-sm-12">
					<p class="t3">Detail View</p>
				</div>
			</div>

			<!-- Session View - Detail View Bar -->
			<div class="row">
				<div class="col-sm-12">
					<div id="d3SessionDetailView">
						<!-- D3 Session View, Detail View: timeline GOES HERE -->
					</div>
					<div class="detailViewBarTemp">
					</div>
				</div>
			</div>

			<!-- Legend -->
			<div class="row">
				<div class="col-sm-2">
					<p class=""></p>
				</div>
			</div>
		</div> <!-- container -->

		<script type="text/javascript">
        	var data;

        	// Main: These functions execute once data has been saved to a global variable
        	// so that the passed JSON document will only be retrieved once.
	        d3.json("BAER_100.json", function(json) {
	        	data = json;

	        	// Header Info
	        	d3SessionNumber();		// D3 Session Number
	        	d3Date();				// D3 Date
	        	d3TherapistName();		// D3 Therapist's Name
	        	d3ClientInfo();			// D3 Client Info

	        	// Overall MI Fidelity
	        	d3OverallMIFidelity();	// D3 Overall MI Fidelity: number
				d3MIAdherence();		// D3 MI Adherence pie chart

				// Global Ratings
				d3GlobalRatings();		// D3 Global Ratings

				// Notes
				d3NotesGeneral();		// D3 Notes: general
				d3NotesStrengths();		// D3 Notes: strengths
				d3NotesImprovements();	// D3 Notes: areas for improvement

				// Behavior Counts
				d3RToQNum();			// D3 Reflection to Question Ratio: number
				d3RToQBarGraph();		// D3 Reflection to Question Ratio: bar graph
				d3POQNum();				// D3 Percent Open Questions: number
				d3POQBar();				// D3 Percent Open Questions: bar graph
				d3PCRNum();				// D3 Percent Complex Reflections: number
				d3PCRBar();				// D3 Percent Complex Reflections: bar graph

				// Session View
				d3PctTalkTimeNum();		// D3 Percent Talk Time: number
				d3PctTalkTimeBar();		// D3 Percent Talk Time: bar graph
				d3SessionView();	// D3 Session View: Overview timeline
        	});

        	// D3 Session Number
        	function d3SessionNumber() {
        		var num = data.sessionNumber;
				d3.select("#d3SessionNumber").text(num);
        	}

        	// D3 Date (and time?)
        	function d3Date() {
        		var date = data.date;
				d3.select("#d3Date").text(date);
        	}

        	// D3 Date (and time?)
        	function d3TherapistName() {
        		var name = data.therapist;
				d3.select("#d3TherapistName").text(name);
        	}

        	// D3 Date (and time?)
        	function d3ClientInfo() {
        		var id = data.client.clientID;
        		var sex = data.client.sex;
        		var age = data.client.age;
				d3.select("#d3ClientInfo").text("ID: " + id + ", " + sex + ", age " + age);
        	}

        	// D3 Overall MI Fidelity: number
        	function d3OverallMIFidelity() {
        		var score = data.scores.globals.overall;
        		d3.select("#d3OverallMIFidelity").text(score);
        	}

	        // D3 MI Adherence Pie Chart
			function d3MIAdherence() {
				var miAdherance = data.scores.miAdherence;
    			var miNon = 100 - miAdherance;
    			var miArr = [ miAdherance, miNon ];

	        	var w = 100;
	        	var h = 100;

	        	var outerRadius = w / 2;
	        	var innerRadius = 0;
				var arc = d3.svg.arc()
					.innerRadius(innerRadius)
					.outerRadius(outerRadius);

				var pie = d3.layout.pie();

				var svg = d3.select("#pie")
					.append("svg")
		            .attr("width", w)
		            .attr("height", h);

    			var arcs = svg.selectAll("g.arc")
			    	.data(pie(miArr))
			        .enter()
			        .append("g")
			        .attr("class", "arc")
			        .attr("transform", "translate(" + outerRadius + ", " + outerRadius + ")");

		        arcs.append("path")
		        	.attr("class", function(d, i) {
		        		if (i == 0) {
		        			return "greenFill"
		        		} else {
		        			return "redFill"
		        		}
		        	})
				    .attr("d", arc);

				arcs.append("text")
					.attr("transform", function(d) {
				        return "translate(" + arc.centroid(d) + ")";
				    })
				    .attr("text-anchor", "middle")
				    .text(function(d, i) {
				    	if (i == 0) {
				    		return Math.round(d.value) + "%";
				    	}
				    })
				    .attr("class", "w900 pieText");
			}

			// D3 Global Ratings
			function d3GlobalRatings() {
				d3.select(window).on("resize.0", resize);	// the ".0" here is a workaround for multiple responsive
															// d3 objects on one page. 

				var w = parseFloat(d3.select("#d3GlobalRatings").style("width"));
				var h = 400;
				var barWidth = w / 5;

				var miSpiritScore = data.scores.globals.miSpirit.toFixed(2);
				var empathyScore = data.scores.globals.empathy.toFixed(2);

				if (empathyScore > 5.0) {
					empathyScore = 5.0;
				}
				if (miSpiritScore > 5.0) {
					miSpiritScore = 5.0;
				}

				var svg = d3.select("#d3GlobalRatings")
					.append("svg")
					.attr("width", w)
					.attr("height", h);

				var totalBackground = svg.append("rect")
					.attr("width", w)
		            .attr("height", h)
					.attr("class", "greenFill");

				var proficiencyBackground = svg.append("rect")
					.attr("width", w)
		            .attr("height", h * 4 / 5)
		            .attr("x", 0)
		            .attr("y", h * 1 / 5)
					.attr("class", "greenFill2");

				var competencyBackground = svg.append("rect")
					.attr("width", w)
		            .attr("height", h * 3.5 / 5)
		            .attr("x", 0)
		            .attr("y", h * 1.5 / 5)
					.attr("class", "greenFill3");

				var proficiencyText = svg.append("text")
					.attr("x", w)
					.attr("y", h * 1.5 / 5)
					.text("p: 3.5 __")
					.attr("class", "globalLabelText");

				var competencyText = svg.append("text")
					.attr("x", w)
					.attr("y", h * 1 / 5)
					.text("c: 4.0 __")
					.attr("class", "globalLabelText");
				
				var miSpiritBar = svg.append("rect")
					.attr("width", barWidth)
					.attr("height", miSpiritScore / 5 * h)
					.attr("x", barWidth)
					.attr("y", (5 - miSpiritScore) / 5 * h)
					.attr("class", "blackFill");

				var miSpiritBarText = svg.append("text")
					.attr("x", barWidth * 1.5)
					.attr("y", (5 - miSpiritScore) / 5 * h + 24)
					.text(miSpiritScore)
					.attr("class", "globalScoreText");

				var empathyBar = svg.append("rect")
					.attr("width", barWidth)
					.attr("height", empathyScore / 5 * h)
					.attr("x", barWidth * 3)
					.attr("y", (5 - empathyScore) / 5 * h)
					.attr("class", "blackFill");

				var empathyBarText = svg.append("text")
					.attr("x", barWidth * 3.5)
					.attr("y", (5 - empathyScore) / 5 * h + 24)
					.text(empathyScore)
					.attr("class", "globalScoreText");

				// Responsive width for D3 Global Ratings: bar graph
				function resize() {
					// adjust width when the window size changes
					w = parseFloat(d3.select("#d3GlobalRatings").style("width"));
					barWidth = w / 5;

					svg.attr("width", w);
					totalBackground.attr("width", w);
					proficiencyBackground.attr("width", w);
					competencyBackground.attr("width", w);
					proficiencyText.attr("x", w);
					competencyText.attr("x", w);
					miSpiritBar.attr("width", barWidth)
						.attr("x", barWidth);
					miSpiritBarText.attr("x", barWidth * 1.5);
					empathyBar.attr("width", barWidth)
						.attr("x", barWidth * 3);
					empathyBarText.attr("x", barWidth * 3.5);
				}
			}

			// D3 Notes: general
			function d3NotesGeneral() {
				var text = data.notes.general;

				d3.select("#d3NotesGeneral")
					.selectAll("p")
					.data(text)
					.enter()
					.append("p")
					.text(function(d) {
						return d.text;
					})
					.attr("class", "p1");
			}

			// D3 Notes: session strengths
			function d3NotesStrengths() {
				var text = data.notes.sessionStrengths;

				d3.select("#d3NotesStrengths")
					.selectAll("p")
					.data(text)
					.enter()
					.append("p")
					.attr("class", "p1")
					.append("span")
					.attr("class", "w900 green")
					.text("+");

				d3.select("#d3NotesStrengths")
					.selectAll("p")
					.append("span")
					.attr("class", null)
					.text(function(d) {
						return " " + d.text;
					});
			}

			// D3 Notes: areas for improvement
			function d3NotesImprovements() {
				var text = data.notes.areasForImprovement;

				d3.select("#d3NotesImprovements")
					.selectAll("p")
					.data(text)
					.enter()
					.append("p")
					.attr("class", "p1")
					.append("span")
					.attr("class", "w900 red")
					.html("&minus;");

				d3.select("#d3NotesImprovements")
					.selectAll("p")
					.append("span")
					.attr("class", null)
					.text(function(d) {
						return " " + d.text;
					});
			}

			// D3 Reflection to Question Ratio: number
			function d3RToQNum() {
				var ratio = data.scores.behaviorCounts.reflectionToQuestion.ratio.toFixed(2);

				d3.select("#d3RToQNum").text(ratio);
			}

			// D3 Reflection to Question Ratio: bar graph
			function d3RToQBarGraph() {
				d3.select(window).on("resize.1", resize);	// the ".1" here is a workaround for multiple responsive
															// d3 objects on one page. 

				var w = parseFloat(d3.select("#d3RToQBar").style("width"));
				var h = 18;

				var r = data.scores.behaviorCounts.reflectionToQuestion.reflections;	// swap
				var q = data.scores.behaviorCounts.reflectionToQuestion.questions; 		// swap
				var ratio = data.scores.behaviorCounts.reflectionToQuestion.ratio.toFixed(2);
				if (ratio > 3.0) {
					ratio = 3.0;
				}

				var svg = d3.select("#d3RToQBar")
					.append("svg")
					.attr("width", w)
					.attr("height", h);

				var totalBar = svg.append("rect")
					.attr("width", w)
		            .attr("height", h)
					.attr("class", "redFill");

				if (ratio > 2.0) {
					var ratioBar1 = svg.append("rect")
						.attr("width", ratio * w / 3.0)
						.attr("height", h)
						.attr("class", "greenFill");
					var ratioBar2 = svg.append("rect")
						.attr("width", w * 2.0 / 3.0)
						.attr("height", h)
						.attr("class", "greenFill2");
					var ratioBar3 = svg.append("rect")
						.attr("width", w * 1.0 / 3.0)
						.attr("height", h)
						.attr("class", "greenFill3");
				} else if (ratio > 1.0) {
					var ratioBar2 = svg.append("rect")
						.attr("width", ratio * w / 3.0)
						.attr("height", h)
						.attr("class", "greenFill2");
					var ratioBar3 = svg.append("rect")
						.attr("width", w * 1.0 / 3.0)
						.attr("height", h)
						.attr("class", "greenFill3");
				} else {
					var ratioBar3 = svg.append("rect")
						.attr("width", ratio * w / 3.0)
						.attr("height", h)
						.attr("class", "greenFill3");
				}

				// Responsive width for D3 Reflection to Question Ratio: bar graph
				function resize() {
					// adjust width when the window size changes
					w = parseFloat(d3.select("#d3RToQBar").style("width"));

					svg.attr("width", w);
					totalBar.attr("width", w);
					if (ratio > 2.0) {
						ratioBar1.attr("width", ratio * w / 3.0);
						ratioBar2.attr("width", w * 2.0 / 3.0);
						ratioBar3.attr("width", w * 1.0 / 3.0);
					} else if (ratio > 1.0) {
						ratioBar2.attr("width", ratio * w / 3.0);
						ratioBar3.attr("width", w * 1.0 / 3.0);
					} else {
						ratioBar3.attr("width", ratio * w / 3.0);
					}
				}
			}

			// D3 Percent Open Questions: number
			function d3POQNum() {
				var pct = data.scores.behaviorCounts.percentOpenQuestions.percent.toFixed(2);
				d3.select("#d3POQNum").text(pct);
			}

			// D3 Percent Open Questions: bar graph
			function d3POQBar() {
				d3.select(window).on("resize.2", resize);	// the ".2" here is a workaround for multiple responsive
															// d3 objects on one page. 

				var w = parseFloat(d3.select("#d3PctOpenQuestionsBar").style("width"));
				var h = 18;

				var oq = data.scores.behaviorCounts.percentOpenQuestions.openQuestions;
				var cq = data.scores.behaviorCounts.percentOpenQuestions.closedQuestions;
				var pct = data.scores.behaviorCounts.percentOpenQuestions.percent.toFixed(2);
				if (pct > 100.0) {
					pct = 100.0;
				}

				var svg = d3.select("#d3PctOpenQuestionsBar")
					.append("svg")
					.attr("width", w)
					.attr("height", h);

				var totalBar = svg.append("rect")
					.attr("width", w)
					.attr("height", h)
					.attr("class", "redFill");

				if (pct > 70) {
					var pctBar1 = svg.append("rect")
						.attr("width", pct / 100 * w)
						.attr("height", h)
						.attr("class", "greenFill");
					var pctBar2 = svg.append("rect")
						.attr("width", w * 0.7)
						.attr("height", h)
						.attr("class", "greenFill2");
					var pctBar3 = svg.append("rect")
						.attr("width", w * 0.5)
						.attr("height", h)
						.attr("class", "greenFill3");
				} else if (pct > 50) {
					var pctBar2 = svg.append("rect")
						.attr("width", pct / 100 * w)
						.attr("height", h)
						.attr("class", "greenFill2");
					var pctBar3 = svg.append("rect")
						.attr("width", w * 0.5)
						.attr("height", h)
						.attr("class", "greenFill3");
				} else {
					var pctBar3 = svg.append("rect")
						.attr("width", pct / 100 * w)
						.attr("height", h)
						.attr("class", "greenFill3");
				}

				// Responsive width for D3 Percent Open Questions: bar graph
				function resize() {
					// adjust width when the window size changes
					w = parseFloat(d3.select("#d3PctOpenQuestionsBar").style("width"));

					svg.attr("width", w);
					totalBar.attr("width", w);
					if (pct > 70) {
						pctBar1.attr("width", pct / 100 * w);
						pctBar2.attr("width", w * 0.7);
						pctBar3.attr("width", w * 0.5);
					} else if (pct > 50) {
						pctBar2.attr("width", pct / 100 * w);
						pctBar3.attr("width", w * 0.5);
					} else {
						pctBar3.attr("width", pct / 100 * w);
					}
				}
			}

			// D3 Percent Complex Reflections: number
			function d3PCRNum() {
				var pct = data.scores.behaviorCounts.percentComplexReflections.percent.toFixed(2);
				d3.select("#d3PCRNum").text(pct);
			}

			// D3 Percent Complex Reflections: bar graph
			function d3PCRBar() {
				d3.select(window).on("resize.3", resize);	// the ".3" here is a workaround for multiple responsive
															// d3 objects on one page. 

				var w = parseFloat(d3.select("#d3PctComplexReflectionsBar").style("width"));
				var h = 18;

				var cr = data.scores.behaviorCounts.percentComplexReflections.complexReflections;
				var sr = data.scores.behaviorCounts.percentComplexReflections.simpleReflections;
				var pct = data.scores.behaviorCounts.percentComplexReflections.percent.toFixed(2);
				if (pct > 100.0) {
					pct = 100.0;
				}

				var svg = d3.select("#d3PctComplexReflectionsBar")
					.append("svg")
					.attr("width", w)
					.attr("height", h);

				var totalBar = svg.append("rect")
					.attr("width", w)
					.attr("height", h)
					.attr("class", "redFill");

				if (pct > 50) {
					var pctBar1 = svg.append("rect")
						.attr("width", pct / 100 * w)
						.attr("height", h)
						.attr("class", "greenFill");
					var pctBar2 = svg.append("rect")
						.attr("width", w * 0.5)
						.attr("height", h)
						.attr("class", "greenFill2");
					var pctBar3 = svg.append("rect")
						.attr("width", w * 0.4)
						.attr("height", h)
						.attr("class", "greenFill3");
				} else if (pct > 40) {
					var pctBar2 = svg.append("rect")
						.attr("width", pct / 100 * w)
						.attr("height", h)
						.attr("class", "greenFill2");
					var pctBar3 = svg.append("rect")
						.attr("width", w * 0.4)
						.attr("height", h)
						.attr("class", "greenFill3");
				} else {
					var pctBar3 = svg.append("rect")
						.attr("width", pct / 100 * w)
						.attr("height", h)
						.attr("class", "greenFill3");
				}

				// Responsive width for D3 Percent Complex Reflections: bar graph
				function resize() {
					// adjust width when the window size changes
					w = parseFloat(d3.select("#d3PctComplexReflectionsBar").style("width"));

					svg.attr("width", w);
					totalBar.attr("width", w);
					if (pct > 50) {
						pctBar1.attr("width", pct / 100 * w);
						pctBar2.attr("width", w * 0.5);
						pctBar3.attr("width", w * 0.4);
					} else if (pct > 40) {
						pctBar2.attr("width", pct / 100 * w);
						pctBar3.attr("width", w * 0.4);
					} else {
						pctBar3.attr("width", pct / 100 * w);
					}
				}
			}

			// D3 Percent Talk Time: number
			function d3PctTalkTimeNum() {
				var pct = data.session.talkTime.therapistToClientPercent * 100;
				d3.select("#d3PctTalkTimeNum").text(pct.toFixed(2));
			}

			// D3 Percent Talk Time: bar graph
			function d3PctTalkTimeBar() {
				d3.select(window).on("resize.4", resize);	// the ".4" here is a workaround for multiple responsive
															// d3 objects on one page. 

				var w = parseFloat(d3.select("#d3PctTalkTimeBar").style("width"));
				var h = 18;

				var therapistPct = data.session.talkTime.therapistToClientPercent;
				var clientPct = 1 - therapistPct;

				var svg = d3.select("#d3PctTalkTimeBar")
					.append("svg")
					.attr("width", w)
					.attr("height", h);

				var totalBar = svg.append("rect")
					.attr("width", w)
					.attr("height", h)
					.attr("class", "blackFill"); // orangeFill ggedit

				var therapistBar= svg.append("rect")
					.attr("width", w * therapistPct)
					.attr("height", h)
					.attr("class", "greenFill");

				// Responsive width for D3 Percent Complex Reflections: bar graph
				function resize() {
					// adjust width when the window size changes
					w = parseFloat(d3.select("#d3PctComplexReflectionsBar").style("width"));

					svg.attr("width", w);
					totalBar.attr("width", w);
					therapistBar.attr("width", w * therapistPct);
				}
			}

			function d3SessionView() {
				//d3.select(window).on("resize.5", resize);	// the ".5" here is a workaround for multiple responsive
															// d3 objects on one page. 

				var w = parseFloat(d3.select("#d3SessionOverview").style("width"));
				var h = 54;

				var talkTurns = data.session.talkTurn;

				var scale = d3.scale.linear()
					.domain([0, d3.max(talkTurns, function(d) { 
						return d["endTime"];
					})])
					.range([0, w]);

				var svg1 = d3.select("#d3SessionOverview")
					.append("svg")
					.attr("width", w)
					.attr("height", h);

				var overviewRects = svg1.selectAll("rect")
					.data(talkTurns)
					.enter()
					.append("rect")

				overviewRects.attr("x", function(d) {
						return scale(d.startTime);
					})
					.attr("width", function(d) {
						return scale(d.duration);
					})
					.attr("height", h)
					.attr("class", function(d) {
						if (d.speaker == "therapist") {
							return "greenFill";
						} else {
							return "blueFill";
						}
					})
					.attr("fill-opacity", function(d) {
						return d.vocalArousal;
					})

				var detail = d3.select("#d3SessionDetailView")
					.append("svg")
					.attr("width", w)
					.attr("height", h)


				
				/*
				// Responsive width for D3 Percent Complex Reflections: bar graph
				function resize() {
					// adjust width when the window size changes
					w = parseFloat(d3.select("#d3PctComplexReflectionsBar").style("width"));

					svg.attr("width", w);
					totalBar.attr("width", w);
					therapistBar.attr("width", w * therapistPct);
				}
				*/
			}

        </script>
    </body>
</html>

















