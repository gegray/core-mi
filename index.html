<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Core-MI Report</title>

        <!-- Include libraries -->
		<script src="https://code.jquery.com/jquery.min.js"></script>
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
		<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
		
		<!-- Add Angular Later
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
		-->

		<!-- Fonts -->
		<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700,900,100italic,300italic,400italic,500italic,700italic,900italic' rel='stylesheet' type='text/css'>

		<!-- Custom CSS -->
		<link href="css/custom.css" type="text/css" rel="stylesheet" />	
    </head>

    <body>
    	<div class="container">

    		<!-- CORE-MI REPORT -->
    		<div class="row headerBackground">
    			<div class="col-sm-12">
		        	<p class="t1">Core-MI Report</p>
		        </div>
		    </div> <!-- row -->
		    <hr />

		    <!-- Session #, Therapist, Client -->
		    <div class="row">
		        <div class="sessionInfo">
	        		<div class="col-sm-4">
				        <p class="t4">Session Number</p>
				        <p class="p1">2015.10.30-14687</p>
				        <p class="p1">March 3, 2015, 3:43 - 4:37pm</p>
				    </div>
				    <div class="col-sm-4">
				        <p class="t4">Therapist</p>
				        <p class="p1">Dr. John Doe, PhD</p>
				    </div>
				    <div class="col-sm-4">
				        <p class="t4">Client</p>
				        <p class="p1">F, age 26</p>
				    </div>
			    </div> <!-- sessionInfo -->
			</div> <!-- row -->
			<hr />

			<!-- Overall, Global, Notes -->
			<div class="row">
				<div class="coreInfo">
					<!-- Left Column -->
					<div class="col-sm-4">
				        <p class="t2">Overall MI Fidelity</p>
				        <p class="totalScore1"><span class="green">7</span><span class="totalScore2">/12</span></p>
				        <p class="t3">MI Adherence</p>

				        <!-- D3 MI Adherence pie chart -->
				        <div id = "pie">
					        <script type="text/javascript">
					        	var data;

					        	// Main: These functions execute once data has been saved to a global variable
					        	// so that the passed JSON document will only be parsed once.
						        d3.json("BAER_100gg.json", function(json) {
						        	data = json;

									d3MIAdherence();	// D3 MI Adherence pie chart
									d3RToQNum();		// D3 Reflection to Question Ratio: number
									d3RToQBarGraph();	// D3 Reflection to Question Ratio: bar graph
					        	});

						        // D3 MI Adherence Pie Chart
								function d3MIAdherence() {
									var miAdherance = data.scores.miAdherance;
				        			var miNon = 100 - miAdherance;
				        			var miArr = [ miAdherance, miNon ];

						        	var w = 100;
						        	var h = 100;

						        	var outerRadius = w / 2;
						        	var innerRadius = 0;
									var arc = d3.svg.arc()
										.innerRadius(innerRadius)
										.outerRadius(outerRadius);

									var pie = d3.layout.pie();

									var svg = d3.select("#pie")
										.append("svg")
							            .attr("width", w)
							            .attr("height", h);

				        			var arcs = svg.selectAll("g.arc")
								    	.data(pie(miArr))
								        .enter()
								        .append("g")
								        .attr("class", "arc")
								        .attr("transform", "translate(" + outerRadius + ", " + outerRadius + ")");

							        arcs.append("path")
							        	.attr("class", function(d, i) {
							        		if (i == 0) {
							        			return "greenFill"
							        		} else {
							        			return "redFill"
							        		}
							        	})
									    .attr("d", arc);

									arcs.append("text")
										.attr("transform", function(d) {
									        return "translate(" + arc.centroid(d) + ")";
									    })
									    .attr("text-anchor", "middle")
									    .text(function(d, i) {
									    	if (i == 0) {
									    		return Math.round(d.value) + "%";
									    	}
									    })
									    .attr("class", "pieText");
								}

								// D3 Reflection to Question Ratio: number
								function d3RToQNum() {
									var ratio = data.scores.behaviorCounts.reflectionToQuestion.ratio.toFixed(2);

									d3.select("#d3RToQNum")
										.text(ratio);
								}

								// D3 Reflection to Question Ratio: bar graph
								function d3RToQBarGraph() {
									var w = 470;
									var h = 18;

									var r = data.scores.behaviorCounts.reflectionToQuestion.questions;		// swap
									var q = data.scores.behaviorCounts.reflectionToQuestion.reflections; 	// swap
									var rqTotal = r + q;
									var ratio = data.scores.behaviorCounts.reflectionToQuestion.ratio.toFixed(2);
									if (ratio > 3.0) {
										ratio = 3.0;
									}
									var ratioWidth = ratio
									var rqArr = [ rqTotal, r, q ];

									/*
									var scale = d3.scale.linear()
										.domain([0, 3.0])
										.range([0, w]);
									*/

									var svg = d3.select("#d3RToQBar")
										.append("svg")
										.attr("width", w)
										.attr("height", h);

									var totalBar = svg.append("rect")
										.attr("width", w)
							            .attr("height", h)
										.attr("class", "redFill");

									var ratioBar = svg.append("rect")
										.attr("width", ratio * w / 3.0)
										.attr("height", h)
										.attr("class", "greenFill");
								}


					        </script>
				        </div>

				        <p class="t3">MI Alerts</p>
				        <p class="p1 red">2 Advise<br>
				        	1 Confront<br>
				        	1 Direction
				        </p>
				    </div>
				    <!-- Middle Column -->
				    <div class="col-sm-4">
				    	<p class="t2">Global Ratings</p>
				    	<div class="barChart"></div>
				    </div>
				    <!-- Right Column -->
				    <div class="col-sm-4">
				    	<p class="t2">Notes</p>
				    	<p class="p1">Fui in sed num ad inate poena usor. Quod nos occhil unceps, que ternumpa. Popota es reniam us eri pratum pro rumus scia vivatra, corid cludenati, ponscerbis re die terorbit. Verfecto.</p>
				    	<p class="t3">Session Strengths</p>
				    	<p class="p1"><span class="plusMinus green">+ </span>Fui in sed num ad inate poena usor</p>
				    	<p class="p1"><span class="plusMinus green">+ </span>Quod nos occhil unceps, que ternumpa</p>
				    	<p class="t3">Areas for Improvement</p>
				    	<p class="p1"><span class="plusMinus red">&minus; </span>Fui in sed num ad inate poena usor</p>
				    	<p class="p1"><span class="plusMinus red">&minus; </span>Quod nos occhil unceps, que ternumpa</p>
				    </div>
				</div> <!-- coreInfo -->
			</div> <!-- row -->
			
			<!-- Behavior Counts -->
			<div class="row">
				<div class="behaviorCounts">
					<!-- Left Column - Blank -->
					<div class="col-sm-4">
					</div>
					<!-- Middle & Right Columns -->
					<div class="col-sm-8">
						<p class="t2">Behavior Counts</p>
						<p class="p1">Reflection to Question Ratio: 
							<span class="w900" id="d3RToQNum">
								<!-- D3 Reflection to Question Ratio: number GOES HERE -->
							</span> (Reflection : Question)
						</p>

						<!-- D3 Reflection to Question: bar graph -->
				        <div id = "d3RToQBar">
					        <!-- D3 Reflection to Question Ratio: bar graph GOES HERE -->
					    </div>

						<p class="p1">Percent Open Questions: <span class="w900">27% </span> (Open : Closed)</p>
						<div class="barTemp">
						</div>
						<p class="p1">Percent Complex Reflections: <span class="w900">75% </span> (Complex : Simple)</p>
						<div class="barTemp">
						</div>
					</div>
				</div> <!-- behaviorCounts -->
			</div> <!-- row -->
			<hr />

			<!-- Session View - Title -->
			<div class="row">
				<div class="col-sm-12">
					<p class="t2">Session View</p>
				</div>
			</div>

			<!-- Session View - Legend -->
			<div class="row">
				<div class="sessionView">
					<div class="col-sm-2">
						<div class="therapistBox">
						</div>
						<p class="p1">Therapist</p>
					</div>
					<div class="col-sm-2">
						<div class="clientBox">
						</div>
						<p class="p1">Client</p>
					</div>
					<div class="col-sm-8">
						<p class="p1">Percent Talk Time: <span class="w900">67% </span> (Therapist : Client)</p>
						<div class="barTemp">
						</div>
					</div>
				</div> <!-- sessionView -->
			</div> <!-- row -->

			<!-- Session View - Overview Title -->
			<div class="row">
				<div class="col-sm-12">
					<p class="t3">Overview</p>
				</div>
			</div>

			<!-- Session View - Overview Bar -->
			<div class="row">
				<div class="col-sm-12">
					<div class="overviewBarTemp">
					</div>
				</div>
			</div> <!-- row -->

			<!-- Session View - Detail View Title -->
			<div class="row">
				<div class="col-sm-12">
					<p class="t3">Detail View</p>
				</div>
			</div>

			<!-- Session View - Detail View Bar -->
			<div class="row">
				<div class="col-sm-12">
					<div class="detailViewBarTemp">
					</div>
				</div>
			</div>

			<!-- Legend -->
			<div class="row">
				<div class="col-sm-2">
					<p class=""></p>
				</div>
			</div>



		</div> <!-- container -->
    </body>
</html>

















